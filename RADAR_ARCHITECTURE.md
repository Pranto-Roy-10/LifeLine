# ğŸ“Š Human Availability Radar - Architecture & Diagrams

## System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      LifeLine Application                        â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     Frontend Layer                        â”‚  â”‚
â”‚  â”‚                   (HTML/JavaScript)                       â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚         Live Map Page (/map)                        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                                                     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  [Availability Radar Button]  (Purple Gradient)   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚         â†“                                          â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  [toggleRadar()]                                  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    â”œâ”€â†’ recordActivityPing()                       â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€â†’ updateRadarHeatmap()                       â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                                                     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  [Google Maps Canvas]                             â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    â”œâ”€ Heatmap Layer (Thermal Gradient)           â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    â”œâ”€ User Markers (15 top active)               â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€ Info Windows (click markers)               â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                                                     â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚               HTTP REST API Layer                        â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  POST /api/activity/ping                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  payload: {lat, lng, activity_type, motion}     â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                         â†“                                â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  POST /api/radar/heatmap                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  payload: {user_lat, user_lng, radius_km}       â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                         â†“                                â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  POST /api/radar/active-users                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  payload: {user_lat, user_lng, radius_km}       â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Backend Processing Layer                    â”‚  â”‚
â”‚  â”‚                    (Flask + Python)                      â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  api_activity_ping()                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Validate user location                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Update user.lat, user.lng                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Create UserActivity record                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Return activity_id                          â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                         â†“                                â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  api_radar_heatmap()                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Query UserActivity (last 5 min)             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Filter by radius                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Calculate intensity (activity + motion)     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Return heatmap_points[]                     â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                         â†“                                â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  api_radar_active_users()                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Query UserActivity (last 10 min)            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Group by user_id, aggregate metrics         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Calculate availability score                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Sort & limit to top 50                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Return users with rankings                  â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Database Layer (SQLite)                     â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Table: user_activity                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ id (PK)                                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ user_id (FK) [INDEX]                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ lat, lng                                     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ activity_type (ping, motion, etc.)         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ device_motion (0-100)                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ created_at [INDEX]                          â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Table: user (existing)                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ id, email, name                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ lat, lng (updated on ping)                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ is_trusted_helper                           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ ... other fields                            â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow for Radar Update Cycle

```
START: User clicks Radar Button
   â”‚
   â”œâ”€â†’ toggleRadar() called
   â”‚   â”‚
   â”‚   â”œâ”€â†’ radarEnabled = !radarEnabled
   â”‚   â”‚
   â”‚   â””â”€â†’ IF ON:
   â”‚       â”œâ”€ Update button UI
   â”‚       â”œâ”€ Set radarRefreshInterval = setInterval(3000ms)
   â”‚       â”‚
   â”‚       â””â”€â†’ EVERY 3 SECONDS:
   â”‚           â”‚
   â”‚           â”œâ”€â†’ recordActivityPing()
   â”‚           â”‚   â”‚
   â”‚           â”‚   â””â”€â†’ POST /api/activity/ping
   â”‚           â”‚       â”œâ”€ lat: userPosition.lat
   â”‚           â”‚       â”œâ”€ lng: userPosition.lng
   â”‚           â”‚       â””â”€ device_motion: random(30-70)
   â”‚           â”‚           â”‚
   â”‚           â”‚           â””â”€â†’ Backend: 
   â”‚           â”‚               â”œâ”€ Update User.lat, User.lng
   â”‚           â”‚               â”œâ”€ Create UserActivity record
   â”‚           â”‚               â””â”€ Return {"ok": true}
   â”‚           â”‚
   â”‚           â”œâ”€â†’ updateRadarHeatmap()
   â”‚           â”‚   â”‚
   â”‚           â”‚   â”œâ”€â†’ clearRadarHeatmap()
   â”‚           â”‚   â”œâ”€â†’ clearRadarMarkers()
   â”‚           â”‚   â”‚
   â”‚           â”‚   â””â”€â†’ POST /api/radar/heatmap
   â”‚           â”‚       â”œâ”€ user_lat, user_lng, radius_km
   â”‚           â”‚       â”‚
   â”‚           â”‚       â””â”€â†’ Backend Processing:
   â”‚           â”‚           â”œâ”€ Query UserActivity
   â”‚           â”‚           â”‚  â””â”€ WHERE created_at >= now - 5min
   â”‚           â”‚           â”‚  â””â”€ WHERE lat != null AND lng != null
   â”‚           â”‚           â”‚  â””â”€ WHERE user_id != current_user
   â”‚           â”‚           â”‚  â””â”€ WHERE distance <= radius_km
   â”‚           â”‚           â”‚
   â”‚           â”‚           â”œâ”€ For each user's activities:
   â”‚           â”‚           â”‚  â”œâ”€ Count pings (activity_count)
   â”‚           â”‚           â”‚  â”œâ”€ Avg motion (device_motion)
   â”‚           â”‚           â”‚  â”œâ”€ Latest activity time
   â”‚           â”‚           â”‚  â”œâ”€ Avg location (lat, lng)
   â”‚           â”‚           â”‚  â”‚
   â”‚           â”‚           â”‚  â””â”€ Calculate intensity:
   â”‚           â”‚           â”‚     intensity = countÃ—15 + motionÃ—0.5
   â”‚           â”‚           â”‚     recency = 1 - (age_seconds/300)
   â”‚           â”‚           â”‚     weight = intensity Ã— recency / 100
   â”‚           â”‚           â”‚
   â”‚           â”‚           â””â”€ Return heatmap_points[] + stats
   â”‚           â”‚
   â”‚           â”œâ”€â†’ Render Heatmap:
   â”‚           â”‚   â”œâ”€ Create google.maps.visualization.HeatmapLayer
   â”‚           â”‚   â”œâ”€ Set data points with weights
   â”‚           â”‚   â”œâ”€ Set color: gradient (blueâ†’red)
   â”‚           â”‚   â”œâ”€ Set radius: 40px
   â”‚           â”‚   â””â”€ addTo map
   â”‚           â”‚
   â”‚           â””â”€â†’ Render Markers:
   â”‚               â”œâ”€ For each of top 15 heatmap_points:
   â”‚               â”‚  â”œâ”€ Create google.maps.Marker
   â”‚               â”‚  â”œâ”€ Position: {lat: point.lat, lng: point.lng}
   â”‚               â”‚  â”œâ”€ Color: blue if is_helper, purple if member
   â”‚               â”‚  â”œâ”€ Size: 5 + (weight Ã— 5) pixels
   â”‚               â”‚  â”œâ”€ Title: user.name + activity count
   â”‚               â”‚  â”œâ”€ Click listener â†’ show InfoWindow
   â”‚               â”‚  â””â”€ Add to map
   â”‚               â”‚
   â”‚               â””â”€ radarMarkers[] updated
   â”‚
   â”‚    [3-second pause]
   â”‚
   â””â”€â†’ REPEAT until:
       â””â”€â†’ User clicks button again (toggleRadar OFF)
           â”œâ”€ radarEnabled = false
           â”œâ”€ clearInterval(radarRefreshInterval)
           â”œâ”€ clearRadarHeatmap()
           â”œâ”€ clearRadarMarkers()
           â””â”€ Update button UI
```

---

## Intensity Calculation Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UserActivity Records Retrieved          â”‚
â”‚  (Last 5 minutes, within radius)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”
    â”‚ Count  â”‚      â”‚ Motion â”‚
    â”‚ Pings  â”‚      â”‚  Data  â”‚
    â”‚        â”‚      â”‚        â”‚
    â”‚ count  â”‚      â”‚ motion â”‚
    â”‚        â”‚      â”‚        â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”˜
         â”‚                â”‚
         â”‚           â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚           â”‚  Average motion    â”‚
         â”‚           â”‚  if motion > 20:   â”‚
         â”‚           â”‚    bonus = m / 2   â”‚
         â”‚           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                â”‚
         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
         â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Activity Intensity       â”‚
         â”‚  = min(100, count Ã— 15)   â”‚
         â”‚    + bonus_for_motion     â”‚
         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
         â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Calculate Recency Factor    â”‚
         â”‚  age = time_since_activity   â”‚
         â”‚  factor = 1 - (age / 300)    â”‚
         â”‚  clamped: max(0.3, factor)   â”‚
         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
         â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Final Weight (0-1)            â”‚
         â”‚  = (intensity Ã— recency) / 100 â”‚
         â”‚  Result: 0.0 to 1.0            â”‚
         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
         â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Heatmap Point Ready  â”‚
         â”‚  {                    â”‚
         â”‚    lat, lng           â”‚
         â”‚    weight: 0.0-1.0     â”‚
         â”‚    user_id, name      â”‚
         â”‚    activity_count     â”‚
         â”‚    is_helper: bool    â”‚
         â”‚  }                    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Availability Score Calculation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Activities (Last 10 min)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                    â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Frequency  â”‚      â”‚  Recency     â”‚
    â”‚             â”‚      â”‚              â”‚
    â”‚  count      â”‚      â”‚  last_time   â”‚
    â”‚  activity   â”‚      â”‚  elapsed     â”‚
    â”‚             â”‚      â”‚              â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
    â”‚ Activity Score    â”‚     â”‚
    â”‚ = min(100,        â”‚     â”‚
    â”‚   count Ã— 20)     â”‚     â”‚
    â”‚                   â”‚     â”‚
    â”‚ Range: 0-100      â”‚     â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
         â”‚              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚              â”‚ Recency Score      â”‚
         â”‚              â”‚ = max(0,           â”‚
         â”‚              â”‚   100 - (e/3))     â”‚
         â”‚              â”‚                    â”‚
         â”‚              â”‚ Range: 0-100       â”‚
         â”‚              â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚
         â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚        â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Device Motion Score     â”‚
    â”‚  = min(100, motion Ã— 2)  â”‚
    â”‚                          â”‚
    â”‚  Range: 0-100            â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Availability Score            â”‚
    â”‚  = (activity +                 â”‚
    â”‚      recency +                 â”‚
    â”‚      motion) / 3               â”‚
    â”‚                                â”‚
    â”‚  Result: 0-100                 â”‚
    â”‚  Higher = More available       â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  User Ranking             â”‚
    â”‚  Sorted by score DESC      â”‚
    â”‚  Limited to top 50         â”‚
    â”‚  Returned to frontend      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Database Schema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        user_activity (NEW TABLE)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id                INTEGER PRIMARY KEY       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ user_id           INTEGER FOREIGN KEY       â”‚ â”€â”€â†’ user.id
â”‚ [INDEX]                                     â”‚    (Indexed)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ lat               FLOAT                     â”‚
â”‚ lng               FLOAT                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ activity_type     VARCHAR(50)               â”‚
â”‚                   â€¢ ping                    â”‚
â”‚                   â€¢ motion                  â”‚
â”‚                   â€¢ request_view            â”‚
â”‚                   â€¢ chat                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ device_motion     FLOAT (0-100)             â”‚
â”‚                   NULL if no motion         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ created_at        DATETIME                  â”‚
â”‚ [INDEX]           (Indexed for time range)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Used by:
  â€¢ Record activity pings
  â€¢ Calculate heatmap intensities
  â€¢ Rank user availability
  â€¢ Historical analysis (future)
```

---

## Request/Response Examples

### Activity Ping

**Request:**
```json
POST /api/activity/ping
{
  "lat": 23.8583808,
  "lng": 90.374144,
  "activity_type": "ping",
  "device_motion": 45.23
}
```

**Response (Success):**
```json
{
  "ok": true,
  "activity_id": 1234
}
```

---

### Heatmap Data

**Request:**
```json
POST /api/radar/heatmap
{
  "user_lat": 23.8583808,
  "user_lng": 90.374144,
  "radius_km": 3
}
```

**Response (Success):**
```json
{
  "ok": true,
  "heatmap_points": [
    {
      "lat": 23.8603,
      "lng": 90.3752,
      "weight": 0.87,
      "user_id": 5,
      "name": "Sarah Khan",
      "is_helper": true,
      "activity_count": 8
    },
    {
      "lat": 23.8571,
      "lng": 90.3735,
      "weight": 0.64,
      "user_id": 3,
      "name": "Ahmed",
      "is_helper": false,
      "activity_count": 4
    }
  ],
  "total_active_nearby": 12,
  "helpers_nearby": 5
}
```

---

### Active Users

**Request:**
```json
POST /api/radar/active-users
{
  "user_lat": 23.8583808,
  "user_lng": 90.374144,
  "radius_km": 3
}
```

**Response (Success):**
```json
{
  "ok": true,
  "active_users": [
    {
      "user_id": 5,
      "name": "Sarah Khan",
      "lat": 23.8603,
      "lng": 90.3752,
      "distance_km": 0.34,
      "availability_score": 92,
      "activity_count": 8,
      "is_helper": true,
      "last_activity_ago_secs": 2
    },
    {
      "user_id": 3,
      "name": "Ahmed",
      "lat": 23.8571,
      "lng": 90.3735,
      "distance_km": 0.18,
      "availability_score": 71,
      "activity_count": 4,
      "is_helper": false,
      "last_activity_ago_secs": 8
    }
  ]
}
```

---

## Frontend State Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Radar State Variables             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ radarEnabled: boolean               â”‚
â”‚   false (initially)                 â”‚
â”‚   true (when activated)             â”‚
â”‚                                     â”‚
â”‚ heatmapLayer: google.maps obj       â”‚
â”‚   null (when off)                   â”‚
â”‚   HeatmapLayer (when on)            â”‚
â”‚                                     â”‚
â”‚ radarMarkers: array                 â”‚
â”‚   [] (empty when off)               â”‚
â”‚   [marker, marker, ...] (when on)   â”‚
â”‚                                     â”‚
â”‚ radarRefreshInterval: number        â”‚
â”‚   null (when off)                   â”‚
â”‚   intervalId (when on)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

State Transitions:
  OFF â†’ ON:  radarEnabled true, start interval
  ON â†’ OFF:  radarEnabled false, clear interval
  Always: Keep visualizations in sync with state
```

---

## Query Performance

```
Heatmap Query Execution:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ SELECT ... FROM user_activity       â”‚
  â”‚ WHERE created_at >= ? - 5min         â”‚
  â”‚ AND user_id != ?                    â”‚
  â”‚ AND lat IS NOT NULL                 â”‚
  â”‚ AND lng IS NOT NULL                 â”‚
  â”‚ [uses INDEX on created_at]          â”‚
  â”‚ [uses INDEX on user_id]             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
              â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Result: O(log n) lookup  â”‚
              â”‚ + distance filtering     â”‚
              â”‚ Typical: < 100ms         â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Active Users Query Execution:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ SELECT user_id,                     â”‚
  â”‚        max(created_at),             â”‚
  â”‚        avg(lat), avg(lng),          â”‚
  â”‚        count(*),                    â”‚
  â”‚        avg(device_motion)           â”‚
  â”‚ FROM user_activity                  â”‚
  â”‚ WHERE created_at >= ? - 10min       â”‚
  â”‚ [uses INDEX on created_at]          â”‚
  â”‚ GROUP BY user_id                    â”‚
  â”‚ ORDER BY score DESC LIMIT 50        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
              â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Result: Fast aggregation  â”‚
              â”‚ Typical: < 200ms          â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Security & Privacy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Security & Privacy Measures           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚  Authentication:                             â”‚
â”‚  â€¢ @login_required on all endpoints          â”‚
â”‚  â€¢ Session validation                        â”‚
â”‚  â€¢ CSRF protection via Flask                 â”‚
â”‚                                              â”‚
â”‚  Authorization:                              â”‚
â”‚  â€¢ Users only see data from their area       â”‚
â”‚  â€¢ Radius filtering prevents distant lookup  â”‚
â”‚  â€¢ No user enumeration possible              â”‚
â”‚                                              â”‚
â”‚  Data Retention:                             â”‚
â”‚  â€¢ Activities auto-expire after 5-10 min     â”‚
â”‚  â€¢ No long-term storage of pings             â”‚
â”‚  â€¢ No historical tracking                    â”‚
â”‚                                              â”‚
â”‚  Privacy:                                    â”‚
â”‚  â€¢ Heatmap is aggregated (no exact locs)    â”‚
â”‚  â€¢ Individual data only in markers           â”‚
â”‚  â€¢ No data shared without consent            â”‚
â”‚                                              â”‚
â”‚  Performance:                                â”‚
â”‚  â€¢ Indexed queries prevent scan attacks     â”‚
â”‚  â€¢ Limited result set (max 50 users)        â”‚
â”‚  â€¢ Rate limiting via natural pagination      â”‚
â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Deployment Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Production Deployment                    â”‚
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Web Server (Flask + Gunicorn)           â”‚  â”‚
â”‚  â”‚  â€¢ Handles /api/activity/ping            â”‚  â”‚
â”‚  â”‚  â€¢ Handles /api/radar/heatmap            â”‚  â”‚
â”‚  â”‚  â€¢ Handles /api/radar/active-users       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚              â”‚            â”‚         â”‚
â”‚      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”‚         â”‚
â”‚      â”‚ Static    â”‚  â”‚ Templates â”‚   â”‚         â”‚
â”‚      â”‚ Assets    â”‚  â”‚ (HTML)    â”‚   â”‚         â”‚
â”‚      â”‚ (CSS/JS)  â”‚  â”‚           â”‚   â”‚         â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚         â”‚
â”‚                                      â”‚         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         Database (SQLite)          â”‚      â”‚  â”‚
â”‚  â”‚                                    â”‚      â”‚  â”‚
â”‚  â”‚  Tables:                           â”‚      â”‚  â”‚
â”‚  â”‚  â€¢ user â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”œâ”€â”€â”¤  â”‚
â”‚  â”‚  â€¢ user_activity â—„â”€â”€â”€ (NEW)        â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â€¢ requests                        â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â€¢ ... other tables ...            â”‚  â”‚  â”‚  â”‚
â”‚  â”‚                                    â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  Indexes:                          â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â€¢ user_activity.user_id [Fast]    â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â€¢ user_activity.created_at [Fast] â”‚  â”‚  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚                                           â”‚  â”‚  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚ Optional: Redis Cache (future)            â”‚  â”‚
â”‚  â”‚  â€¢ Cache heatmap for 1-2 seconds          â”‚  â”‚
â”‚  â”‚  â€¢ Reduce DB load                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

*Architecture Diagrams v1.0*  
*December 18, 2025*

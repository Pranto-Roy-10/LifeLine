{% extends "base.html" %}
{% block content %}

<div class="max-w-6xl mx-auto px-6 py-10 page-transition">

  <h1 class="text-4xl font-bold bg-gradient-to-r from-emerald-300 to-cyan-300 bg-clip-text text-transparent mb-6">
    Community Events Near You
  </h1>

  <div class="mb-6">
    <a href="{{ url_for('create_event') }}" class="bg-gradient-to-r from-emerald-500 to-cyan-500 hover:from-emerald-600 hover:to-cyan-600 text-slate-950 font-semibold px-6 py-3 rounded-lg transition hover:scale-105 inline-block">
      âœ¨ Create New Event
    </a>
  </div>

  <!-- Map -->
  <div id="map"
       class="w-full h-96 rounded-xl border border-emerald-500/20 mb-8 shadow-lg"></div>

  <!-- Event List -->
  <div class="grid md:grid-cols-2 gap-6">
    {% for e in events %}
    <div class="bg-gradient-to-br from-slate-900/80 to-slate-950/90 p-6 rounded-xl border border-emerald-500/20 card-hover hover:border-emerald-400/40 shadow-lg">

      <h3 class="text-xl font-semibold bg-gradient-to-r from-emerald-300 to-cyan-300 bg-clip-text text-transparent">
        {{ e.title }}
      </h3>

      <p class="text-slate-400 text-sm mt-3">
        {{ e.description }}
      </p>

      <div class="mt-4 space-y-2 text-slate-500 text-sm">
        <p>ğŸ“ {{ e.area }}</p>
        <p>ğŸ“… {{ e.date.strftime('%B %d, %Y') }}</p>
        <p>â±ï¸ {{ e.created_at.strftime('%B %d, %Y') if e.created_at else 'Date unknown' }}
          â†’
          {% if e.completed %}
            {{ (e.completed_at or e.date).strftime('%B %d, %Y') if (e.completed_at or e.date) else 'Date unknown' }}
          {% else %}
            In progress
          {% endif %}
        </p>
      </div>

      <!-- Interest -->
      <form method="POST"
            action="{{ url_for('event_interest', event_id=e.id) }}"
            class="mt-6">
        <button class="px-6 py-2 text-sm font-semibold rounded-lg
                       bg-gradient-to-r from-emerald-500 to-cyan-500 hover:from-emerald-600 hover:to-cyan-600 text-slate-950 transition hover:scale-105 w-full">
          â¤ï¸ Interested
        </button>
      </form>

      <!-- Helper only -->
      {% if current_user.role == "helper" and current_user.id == e.creator_id %}
        {% if not e.completed %}
        <form method="POST"
              action="{{ url_for('complete_event', event_id=e.id) }}"
              class="mt-3">
          <button class="px-6 py-2 text-sm font-semibold rounded-lg
                         bg-gradient-to-r from-teal-500 to-emerald-500 hover:from-teal-600 hover:to-emerald-600 text-slate-950 transition hover:scale-105 w-full">
            âœ… Mark as Completed
          </button>
        </form>
        {% else %}
        <span class="text-emerald-400 text-sm mt-4 block font-semibold">
          âœ” Event Completed
        </span>
        {% endif %}
      {% endif %}

    </div>
    {% endfor %}
  </div>
</div>

<script>
function initMap() {
  const map = new google.maps.Map(document.getElementById("map"), {
    zoom: 12,
    center: { lat: 23.8103, lng: 90.4125 },
    styles: [
      { featureType: "all", elementType: "labels", stylers: [{ visibility: "off" }] }
    ]
  });

  {% for e in events %}
  new google.maps.Marker({
    position: { lat: {{ e.lat }}, lng: {{ e.lng }} },
    map,
    title: "{{ e.title }}"
  });
  {% endfor %}
}
</script>

<script
  src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_key }}&callback=initMap"
  async defer>
</script>

{% endblock %}

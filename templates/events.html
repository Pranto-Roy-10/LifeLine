{% extends "base.html" %}
{% block content %}

<div class="max-w-6xl mx-auto px-6 py-10">

  <h1 class="text-3xl font-bold text-white mb-6">
    Community Events Near You
  </h1>

  <div class="mb-6">
    <a href="{{ url_for('create_event') }}" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium transition">
      Create New Event
    </a>
  </div>

  <!-- Map -->
  <div id="map"
       class="w-full h-96 rounded-xl border border-gray-800 mb-8"></div>

  <!-- Event List -->
  <div class="grid md:grid-cols-2 gap-6">
    {% for e in events %}
    <div class="bg-[#0b1220] p-6 rounded-xl border border-gray-800">

      <h3 class="text-xl font-semibold text-white">
        {{ e.title }}
      </h3>

      <p class="text-gray-400 text-sm mt-2">
        {{ e.description }}
      </p>

      <p class="text-gray-500 text-sm mt-2">
        ğŸ“ {{ e.area }} <br>
        ğŸ“… {{ e.date.strftime('%B %d, %Y') }}
      </p>

      <!-- Interest -->
      <form method="POST"
            action="{{ url_for('event_interest', event_id=e.id) }}"
            class="mt-4">
        <button class="px-4 py-2 text-sm rounded-lg
                       bg-indigo-600 hover:bg-indigo-700 text-white">
          â¤ï¸ Interested
        </button>
      </form>

      <!-- Helper only -->
      {% if current_user.role == "helper" and current_user.id == e.creator_id %}
        {% if not e.completed %}
        <form method="POST"
              action="{{ url_for('complete_event', event_id=e.id) }}"
              class="mt-3">
          <button class="px-4 py-2 text-sm rounded-lg
                         bg-emerald-600 hover:bg-emerald-700 text-white">
            âœ… Mark as Completed
          </button>
        </form>
        {% else %}
        <span class="text-green-400 text-sm mt-3 block">
          âœ” Event Completed
        </span>
        {% endif %}
      {% endif %}

    </div>
    {% endfor %}
  </div>
</div>

<script>
function initMap() {
  const map = new google.maps.Map(document.getElementById("map"), {
    zoom: 12,
    center: { lat: 23.8103, lng: 90.4125 },
    styles: [
      { featureType: "all", elementType: "labels", stylers: [{ visibility: "off" }] }
    ]
  });

  {% for e in events %}
  new google.maps.Marker({
    position: { lat: {{ e.lat }}, lng: {{ e.lng }} },
    map,
    title: "{{ e.title }}"
  });
  {% endfor %}
}
</script>

<script
  src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_key }}&callback=initMap"
  async defer>
</script>

{% endblock %}

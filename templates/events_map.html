{% extends "base.html" %} {% block content %}

<div class="max-w-6xl mx-auto px-4 sm:px-6 py-6 sm:py-8">
  <h1 class="text-2xl sm:text-3xl font-bold text-white mb-4 sm:mb-6">
    Community Events Map
  </h1>

  <div
    id="map"
    class="w-full h-[60vh] min-h-[320px] md:h-[500px] rounded-xl border border-gray-700"
  ></div>
</div>

<script id="events-data" type="application/json">
  {{ (events_json or []) | tojson }}
</script>

<script>
  const events = JSON.parse(
    document.getElementById("events-data").textContent || "[]"
  );

  function initMap() {
    const center = { lat: 23.8103, lng: 90.4125 }; // Dhaka
    const map = new google.maps.Map(document.getElementById("map"), {
      zoom: 12,
      center: center,
      styles: [
        { elementType: "geometry", stylers: [{ color: "#0f172a" }] },
        { elementType: "labels.text.fill", stylers: [{ color: "#e5e7eb" }] },
        { elementType: "labels.text.stroke", stylers: [{ color: "#0f172a" }] },
      ],
    });

    events.forEach((e) => {
      const marker = new google.maps.Marker({
        position: { lat: e.lat, lng: e.lng },
        map: map,
        title: e.title,
      });

      const info = new google.maps.InfoWindow({
        content: `
        <div style="color:black">
          <strong>${e.title}</strong><br>
          ${e.description}<br>
          ğŸ“ ${e.area}<br>
          ğŸ“… ${e.date}<br>
          â±ï¸ ${e.created ? e.created : "Date unknown"} â†’ ${
          e.isCompleted ? e.completed || e.date : "In progress"
        }
        </div>
      `,
      });

      marker.addListener("click", () => info.open(map, marker));
    });
  }
</script>

<script
  src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_key }}&callback=initMap"
  async
  defer
></script>

{% endblock %}

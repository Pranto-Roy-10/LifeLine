{% extends 'base.html' %}
{% block content %}
<div class="chat-container">
  <div class="chat-header">
    <div class="avatar">{{ other_user.name[0].upper() }}</div>
    <div>
      <h2>{{ other_user.name }}</h2>
    </div>
  </div>

  <div class="chat-window">
    <div class="messages" id="messages" aria-live="polite"></div>

    <div style="margin-bottom:10px;padding:0 4px;font-size:12px;color:#94a3b8">
      {% if translation_enabled %}
      <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px;flex-wrap:wrap">
        <label for="translate_to" style="font-size:12px">Translate to:</label>
        <select id="translate_to" style="padding:4px 8px;border-radius:4px;border:1px solid rgba(30,41,59,0.8);background:rgba(30,41,59,0.3);color:#e2e8f0;font-size:12px">
          <option value="">(none)</option>
          <option value="en">English</option>
          <option value="es">Spanish</option>
          <option value="fr">French</option>
          <option value="bn">Bengali</option>
          <option value="ar">Arabic</option>
        </select>
        <label style="font-size:12px;display:flex;align-items:center;gap:4px"><input type="checkbox" id="auto_translate"> Auto-translate</label>
      </div>
      {% else %}
      <span style="color:#64748b">Translation not available (enable Google Translate API).</span>
      {% endif %}
    </div>

    <div class="chat-input-bar">
      <input id="message_input" class="chat-input" placeholder="Type a message..." />
      <button id="send_btn" class="send-btn">Send</button>
    </div>
    <div class="typing-indicator" id="typing"></div>
  </div>
</div>

<script>
  const CURRENT_USER_ID = {{ current_user.id if current_user else 'null' }};
  const CONVERSATION_ID = {{ conversation.id }};
  const OTHER_USER_ID = {{ other_user.id }};
  const PRELOAD_MESSAGES = {{ messages|length }};
  const MESSAGES = {{ messages|tojson }};
</script>
<script src="/socket.io/socket.io.js"></script>
<script src="{{ url_for('static', filename='js/chat.js') }}"></script>
{% endblock %}

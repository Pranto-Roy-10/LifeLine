{% extends "base.html" %} {% block content %}

<div class="max-w-3xl mx-auto px-6 py-10">
  <h1 class="text-3xl font-bold text-white mb-8">Create Community Event</h1>

  <form
    method="POST"
    class="space-y-6 bg-[#0b1220] p-8 rounded-xl border border-gray-800"
  >
    <!-- Event Title -->
    <div>
      <label class="block text-gray-400 mb-1">Event Title</label>
      <input
        name="title"
        required
        placeholder="e.g. Free medical camp for elders"
        class="w-full px-4 py-3 rounded-lg bg-[#111827] text-white border border-gray-700 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"
      />
    </div>

    <!-- Description -->
    <div>
      <label class="block text-gray-400 mb-1">Description</label>
      <textarea
        name="description"
        rows="4"
        placeholder="Example: A free medical camp offering basic health checkups, blood pressure tests, and free consultation for elderly people in the neighborhood."
        class="w-full px-4 py-3 rounded-lg bg-[#111827] text-white border border-gray-700 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"
      ></textarea>
    </div>

    <!-- Event Type -->
    <div>
      <label class="block text-gray-400 mb-1">Event Type</label>
      <select
        name="event_type"
        class="w-full px-4 py-3 rounded-lg bg-[#111827] text-white border border-gray-700"
      >
        <option value="donation">Donation Drive</option>
        <option value="cleanup">Clean-up Day</option>
        <option value="repair">Repair Camp</option>
        <option value="others">Others</option>
      </select>
    </div>

    <!-- Date -->
    <div>
      <label class="block text-gray-400 mb-1">Event Date</label>
      <input
        type="date"
        name="date"
        required
        class="w-full px-4 py-3 rounded-lg bg-[#111827] text-white border border-gray-700"
      />
    </div>

    <!-- Area -->
    <div>
      <label class="block text-gray-400 mb-1">Area / Neighborhood</label>
      <input
        name="area"
        placeholder="e.g. Badda, near BRACU"
        class="w-full px-4 py-3 rounded-lg bg-[#111827] text-white border border-gray-700 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"
      />
    </div>

    <!-- Use My Location -->
    <button
      type="button"
      onclick="useMyLocation()"
      class="px-4 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white text-sm"
    >
      üìç Use my current location
    </button>

    <!-- Hidden lat/lng (backend still gets values, user doesn't see them) -->
    <input type="hidden" id="lat" name="lat" />
    <input type="hidden" id="lng" name="lng" />

    <!-- Map -->
    <div class="mt-4">
      <label class="block text-gray-400 mb-2">
        Pin your exact location on map
      </label>
      <div id="map" class="w-full h-64 rounded-xl border border-gray-800"></div>
    </div>

    <!-- Actions -->
    <div class="flex justify-end gap-4 pt-6">
      <a
        href="{{ url_for('list_events') }}"
        class="px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 text-white"
      >
        Cancel
      </a>

      <button
        type="submit"
        class="px-6 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white"
      >
        Create Event
      </button>
    </div>
  </form>
</div>

<!-- JS -->
<script>
  let map, marker;

  function useMyLocation() {
    navigator.geolocation.getCurrentPosition((pos) => {
      const loc = {
        lat: pos.coords.latitude,
        lng: pos.coords.longitude,
      };
      map.setCenter(loc);
      placeMarker(loc);
    });
  }

  function initMap() {
    const defaultLoc = { lat: 23.8103, lng: 90.4125 };

    map = new google.maps.Map(document.getElementById("map"), {
      zoom: 13,
      center: defaultLoc,

      // ‚úÖ ENABLE CONTROLS
      zoomControl: true,
      mapTypeControl: false,
      streetViewControl: false,
      fullscreenControl: true,

      styles: [
        {
          featureType: "all",
          elementType: "labels",
          stylers: [{ visibility: "off" }],
        },
        { elementType: "geometry", stylers: [{ color: "#0b1220" }] },
      ],
    });

    map.addListener("click", (e) => {
      placeMarker(e.latLng);
    });
  }

  function placeMarker(location) {
    if (!marker) {
      marker = new google.maps.Marker({ map });
    }
    marker.setPosition(location);

    document.getElementById("lat").value = location.lat();
    document.getElementById("lng").value = location.lng();
  }
</script>

<script
  src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_key }}&callback=initMap"
  async
  defer
></script>

{% endblock %}

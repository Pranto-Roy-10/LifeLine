{% extends "base.html" %} {% block title %}Upgrade Plan â€“ LifeLine{% endblock %}
{% block content %}
<div class="min-h-screen bg-slate-950 text-slate-100 py-16 px-6">
  {% set payment_pending = latest_payment and latest_payment.status == 'pending'
  %} {% set payment_rejected = latest_payment and latest_payment.status ==
  'rejected' %} {% set payment_approved = latest_payment and
  latest_payment.status == 'approved' %} {% if payment_pending %}
  <div class="max-w-7xl mx-auto mb-10">
    <div class="rounded-3xl border border-amber-500/30 bg-amber-500/10 p-6">
      <div
        class="flex flex-col md:flex-row md:items-center md:justify-between gap-3"
      >
        <div>
          <p class="text-xs font-bold uppercase text-amber-300">
            Payment Under Review
          </p>
          <p class="text-slate-100 font-bold mt-1">
            Your subscription request is under review by admin.
          </p>
          <p class="text-xs text-slate-300 mt-1">
            Amount:
            <span class="font-bold text-white"
              >à§³{{ latest_payment.amount }}</span
            >
            Â· TrxID:
            <span class="font-mono text-amber-200"
              >{{ latest_payment.trx_id }}</span
            >
            Â· Submitted:
            <span class="text-slate-300"
              >{{ latest_payment.created_at.strftime('%d %b, %H:%M') }}</span
            >
          </p>
        </div>
        <div class="text-xs text-slate-300">
          New submissions are disabled until a decision.
        </div>
      </div>
    </div>
  </div>
  {% elif payment_rejected %}
  <div class="max-w-7xl mx-auto mb-10">
    <div class="rounded-3xl border border-rose-500/30 bg-rose-500/10 p-6">
      <p class="text-xs font-bold uppercase text-rose-300">Payment Rejected</p>
      <p class="text-slate-100 font-bold mt-1">
        Your last payment was rejected. You can submit again.
      </p>
      <p class="text-xs text-slate-300 mt-1">
        Last attempt: à§³{{ latest_payment.amount }} Â· TrxID:
        <span class="font-mono">{{ latest_payment.trx_id }}</span>
      </p>
    </div>
  </div>
  {% elif payment_approved %}
  <div class="max-w-7xl mx-auto mb-10">
    <div class="rounded-3xl border border-emerald-500/30 bg-emerald-500/10 p-6">
      <p class="text-xs font-bold uppercase text-emerald-300">
        Payment Approved
      </p>
      <p class="text-slate-100 font-bold mt-1">Your premium is active.</p>
    </div>
  </div>
  {% endif %}

  <div class="text-center max-w-3xl mx-auto mb-16">
    <h1 class="text-4xl md:text-5xl font-bold mb-6">
      Upgrade your
      <span
        class="text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-cyan-400"
        >impact</span
      >
    </h1>

    <div
      class="inline-flex bg-slate-900 p-1 rounded-full border border-slate-800 relative"
    >
      <div
        id="toggleBg"
        class="absolute top-1 left-1 bottom-1 w-[calc(50%-4px)] bg-slate-800 rounded-full transition-all duration-300"
      ></div>

      <button
        onclick="switchPlan('personal')"
        id="btnPersonal"
        class="relative z-10 px-8 py-2 rounded-full text-sm font-semibold text-white transition duration-300"
      >
        Personal
      </button>
      <button
        onclick="switchPlan('business')"
        id="btnBusiness"
        class="relative z-10 px-8 py-2 rounded-full text-sm font-semibold text-slate-400 hover:text-white transition duration-300"
      >
        Business
      </button>
    </div>
  </div>

  <div
    id="personalPlans"
    class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-7xl mx-auto transition-opacity duration-300"
  >
    <div
      class="bg-slate-900/50 border border-slate-800 rounded-3xl p-8 flex flex-col hover:border-slate-700 transition"
    >
      <h3 class="text-xl font-bold text-slate-100">Basic</h3>
      <div class="my-4"><span class="text-4xl font-bold">Free</span></div>
      <p class="text-slate-400 text-sm mb-8 h-10">
        Essential tools for neighbors.
      </p>
      <button
        disabled
        class="w-full py-3 rounded-xl border border-slate-700 text-slate-500 font-semibold mb-8 cursor-default"
      >
        Current Plan
      </button>
      <ul class="space-y-4 text-sm text-slate-300 flex-1">
        <li class="flex gap-3">
          <span class="text-emerald-400">âœ“</span> Access Help Map
        </li>
        <li class="flex gap-3">
          <span class="text-emerald-400">âœ“</span> Respond to Requests
        </li>
        <li class="flex gap-3 text-slate-500">
          <span class="text-rose-500">âš </span> Limit: 2 Posts / 3 Weeks
        </li>
      </ul>
    </div>

    <div
      class="bg-slate-900 border border-emerald-500/50 rounded-3xl p-8 flex flex-col relative shadow-[0_0_30px_rgba(16,185,129,0.1)] scale-105 z-10"
    >
      <div
        class="absolute -top-3 left-1/2 -translate-x-1/2 bg-gradient-to-r from-emerald-500 to-teal-500 text-slate-950 text-[10px] font-bold px-3 py-1 rounded-full uppercase tracking-wider"
      >
        Most Popular
      </div>
      <h3 class="text-xl font-bold text-emerald-400">Premium</h3>
      <div class="my-4 flex items-baseline gap-1">
        <span class="text-4xl font-bold text-white">à§³500</span
        ><span class="text-slate-400 text-sm">/ mo</span>
      </div>
      <p class="text-slate-400 text-sm mb-8 h-10">
        Unlimited access & priority.
      </p>
      {% if payment_pending %}
      <button
        disabled
        class="w-full py-3 rounded-xl border border-slate-700 text-slate-500 font-bold mb-8 cursor-not-allowed"
      >
        Under Review
      </button>
      {% else %}
      <button
        onclick="openPaymentModal('Premium', 500)"
        class="w-full py-3 rounded-xl bg-emerald-500 hover:bg-emerald-400 text-slate-950 font-bold mb-8 transition shadow-lg shadow-emerald-500/20"
      >
        Get Premium
      </button>
      {% endif %}
      <ul class="space-y-4 text-sm text-slate-200 flex-1">
        <li class="flex gap-3">
          <span class="text-emerald-400">âœ¦</span>
          <strong>Unlimited</strong> Posts
        </li>
        <li class="flex gap-3">
          <span class="text-emerald-400">âœ¦</span> "Trusted Helper" Badge
        </li>
        <li class="flex gap-3">
          <span class="text-emerald-400">âœ¦</span> Priority SOS Broadcasts
        </li>
      </ul>
    </div>

    <div
      class="bg-slate-900/50 border border-rose-500/30 rounded-3xl p-8 flex flex-col hover:border-rose-500/60 transition"
    >
      <h3 class="text-xl font-bold text-rose-400">Angel</h3>
      <div class="my-4 flex items-baseline gap-1">
        <span class="text-4xl font-bold text-white">à§³2000</span
        ><span class="text-slate-400 text-sm">/ mo</span>
      </div>
      <p class="text-slate-400 text-sm mb-8 h-10">Maximize community impact.</p>
      {% if payment_pending %}
      <button
        disabled
        class="w-full py-3 rounded-xl border border-slate-700 text-slate-500 font-bold mb-8 cursor-not-allowed"
      >
        Under Review
      </button>
      {% else %}
      <button
        onclick="openPaymentModal('Angel', 2000)"
        class="w-full py-3 rounded-xl bg-slate-100 hover:bg-white text-slate-900 font-bold mb-8 transition"
      >
        Become an Angel
      </button>
      {% endif %}
      <ul class="space-y-4 text-sm text-slate-300 flex-1">
        <li class="flex gap-3">
          <span class="text-rose-400">â˜…</span> Everything in Premium
        </li>
        <li class="flex gap-3">
          <span class="text-rose-400">â˜…</span> <strong>Featured</strong> on
          Dashboard
        </li>
        <li class="flex gap-3">
          <span class="text-rose-400">â˜…</span> Exclusive "Angel" Badge
        </li>
      </ul>
    </div>
  </div>

  <div
    id="businessPlans"
    class="hidden grid grid-cols-1 md:grid-cols-3 gap-6 max-w-7xl mx-auto transition-opacity duration-300"
  >
    <div
      class="bg-slate-900/50 border border-blue-500/30 rounded-3xl p-8 flex flex-col hover:border-blue-500/60 transition"
    >
      <h3 class="text-xl font-bold text-blue-400">Merchant</h3>
      <div class="my-4 flex items-baseline gap-1">
        <span class="text-4xl font-bold text-white">à§³1000</span
        ><span class="text-slate-400 text-sm">/ mo</span>
      </div>
      <p class="text-slate-400 text-sm mb-8 h-10">
        For local shops & services.
      </p>
      {% if payment_pending %}
      <button
        disabled
        class="w-full py-3 rounded-xl border border-slate-700 text-slate-500 font-bold mb-8 cursor-not-allowed"
      >
        Under Review
      </button>
      {% else %}
      <button
        onclick="openPaymentModal('Merchant', 1000)"
        class="w-full py-3 rounded-xl bg-blue-600 hover:bg-blue-500 text-white font-bold mb-8 transition"
      >
        Verify Business
      </button>
      {% endif %}
      <ul class="space-y-4 text-sm text-slate-300 flex-1">
        <li class="flex gap-3">
          <span class="text-blue-400">âœ“</span>
          <strong>Verified Business</strong> Badge
        </li>
        <li class="flex gap-3">
          <span class="text-blue-400">âœ“</span> Post 10 Service Offers/wk
        </li>
        <li class="flex gap-3">
          <span class="text-blue-400">âœ“</span> Visible on "Local Services"
        </li>
      </ul>
    </div>

    <div
      class="bg-slate-900 border border-purple-500/50 rounded-3xl p-8 flex flex-col relative shadow-[0_0_30px_rgba(168,85,247,0.15)] scale-105 z-10"
    >
      <div
        class="absolute -top-3 left-1/2 -translate-x-1/2 bg-gradient-to-r from-purple-500 to-indigo-500 text-white text-[10px] font-bold px-3 py-1 rounded-full uppercase tracking-wider"
      >
        High Visibility
      </div>
      <h3 class="text-xl font-bold text-purple-400">Partner</h3>
      <div class="my-4 flex items-baseline gap-1">
        <span class="text-4xl font-bold text-white">à§³5000</span
        ><span class="text-slate-400 text-sm">/ mo</span>
      </div>
      <p class="text-slate-400 text-sm mb-8 h-10">Dominate local presence.</p>
      {% if payment_pending %}
      <button
        disabled
        class="w-full py-3 rounded-xl border border-slate-700 text-slate-500 font-bold mb-8 cursor-not-allowed"
      >
        Under Review
      </button>
      {% else %}
      <button
        onclick="openPaymentModal('Partner', 5000)"
        class="w-full py-3 rounded-xl bg-purple-600 hover:bg-purple-500 text-white font-bold mb-8 transition shadow-lg"
      >
        Become a Partner
      </button>
      {% endif %}
      <ul class="space-y-4 text-sm text-slate-200 flex-1">
        <li class="flex gap-3">
          <span class="text-purple-400">âœ¦</span> <strong>Featured</strong> Map
          Pin (Logo)
        </li>
        <li class="flex gap-3">
          <span class="text-purple-400">âœ¦</span> Sponsor Community Events
        </li>
        <li class="flex gap-3">
          <span class="text-purple-400">âœ¦</span> Monthly Impact Analytics
        </li>
      </ul>
    </div>

    <div
      class="bg-slate-900/50 border border-slate-700 rounded-3xl p-8 flex flex-col hover:border-slate-500 transition"
    >
      <h3 class="text-xl font-bold text-white">Corporate</h3>
      <div class="my-4">
        <span class="text-4xl font-bold">Custom</span>
      </div>
      <p class="text-slate-400 text-sm mb-8 h-10">
        For CSR & large organizations.
      </p>
      <a
        href="mailto:sales@lifeline.com"
        class="w-full py-3 rounded-xl border border-slate-600 text-white font-bold text-center hover:bg-slate-800 mb-8 transition"
        >Contact Sales</a
      >
      <ul class="space-y-4 text-sm text-slate-300 flex-1">
        <li class="flex gap-3">
          <span class="text-white">â˜…</span> CSR Impact Reports
        </li>
        <li class="flex gap-3">
          <span class="text-white">â˜…</span> Bulk Employee Accounts
        </li>
        <li class="flex gap-3">
          <span class="text-white">â˜…</span> Dedicated Account Manager
        </li>
      </ul>
    </div>
  </div>

  <div class="text-center mt-12 text-slate-500 text-xs">
    <p>Subscriptions help us maintain servers and verify users manually.</p>
    <a href="#" class="underline hover:text-slate-300"
      >Terms & Conditions apply.</a
    >
  </div>
</div>

<div
  id="paymentModal"
  class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm hidden"
>
  <div
    class="bg-slate-900 border border-slate-700 rounded-3xl p-8 w-full max-w-md shadow-2xl relative"
  >
    <button
      onclick="closePaymentModal()"
      class="absolute top-4 right-4 text-slate-500 hover:text-white"
    >
      âœ•
    </button>

    <div class="text-center mb-6">
      <div
        class="w-16 h-16 bg-pink-600/20 rounded-xl flex items-center justify-center mx-auto mb-4 border border-pink-500/50"
      >
        <span class="text-2xl">ðŸ’¸</span>
      </div>
      <h3 class="text-xl font-bold text-white">Pay via bKash</h3>
      <p class="text-sm text-slate-400 mt-1">
        Upgrade to
        <span id="planName" class="text-emerald-400 font-bold">Premium</span>
      </p>
    </div>

    <div class="bg-slate-950 rounded-xl p-4 border border-slate-800 mb-6">
      <ol class="text-sm text-slate-300 space-y-3 list-decimal list-inside">
        <li>Go to bKash App > <strong>Send Money</strong>.</li>
        <li>
          Enter Number:
          <span class="font-mono text-lg text-pink-500 font-bold select-all"
            >01303599797</span
          >
        </li>
        <li>
          Amount:
          <strong class="text-white">à§³<span id="payAmount">500</span></strong>
        </li>
        <li>Reference: <strong class="text-white">LifeLine</strong></li>
        <li>Copy the <strong>TrxID</strong> and paste below.</li>
      </ol>
    </div>

    <form
      action="{{ url_for('submit_manual_payment') }}"
      method="POST"
      class="space-y-4"
    >
      <input type="hidden" name="amount" id="paymentAmountInput" value="500" />
      <input
        type="hidden"
        name="plan_name"
        id="paymentPlanInput"
        value="Premium"
      />
      <div>
        <label class="block text-xs font-bold text-slate-500 mb-1"
          >Your bKash Number</label
        >
        <input
          type="text"
          name="bkash_number"
          placeholder="01XXXXXXXXX"
          required
          class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-pink-500 focus:outline-none"
        />
      </div>
      <div>
        <label class="block text-xs font-bold text-slate-500 mb-1"
          >Transaction ID (TrxID)</label
        >
        <input
          type="text"
          name="trx_id"
          placeholder="e.g. 8J7S9K2L..."
          required
          class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white font-mono tracking-wide focus:border-pink-500 focus:outline-none uppercase"
        />
      </div>
      <button
        type="submit"
        class="w-full py-3.5 rounded-xl bg-pink-600 hover:bg-pink-500 text-white font-bold text-center transition shadow-lg mt-2"
      >
        Verify Payment
      </button>
    </form>
  </div>
</div>

<script>
  function switchPlan(type) {
    const toggleBg = document.getElementById("toggleBg");
    const btnPersonal = document.getElementById("btnPersonal");
    const btnBusiness = document.getElementById("btnBusiness");
    const personalPlans = document.getElementById("personalPlans");
    const businessPlans = document.getElementById("businessPlans");

    if (type === "personal") {
      toggleBg.style.left = "4px";
      toggleBg.style.width = "calc(50% - 4px)";
      btnPersonal.classList.replace("text-slate-400", "text-white");
      btnBusiness.classList.replace("text-white", "text-slate-400");

      personalPlans.classList.remove("hidden");
      businessPlans.classList.add("hidden");
    } else {
      toggleBg.style.left = "50%";
      toggleBg.style.width = "calc(50% - 4px)";
      btnBusiness.classList.replace("text-slate-400", "text-white");
      btnPersonal.classList.replace("text-white", "text-slate-400");

      personalPlans.classList.add("hidden");
      businessPlans.classList.remove("hidden");
    }
  }

  function openPaymentModal(plan, amount) {
    document.getElementById("planName").innerText = plan;
    document.getElementById("payAmount").innerText = amount;
    const amountInput = document.getElementById("paymentAmountInput");
    if (amountInput) amountInput.value = amount;
    const planInput = document.getElementById("paymentPlanInput");
    if (planInput) planInput.value = plan;
    document.getElementById("paymentModal").classList.remove("hidden");
  }

  function closePaymentModal() {
    document.getElementById("paymentModal").classList.add("hidden");
  }
</script>
{% endblock %}
